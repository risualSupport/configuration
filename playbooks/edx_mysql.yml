---

# Example configuration for multi-server community installs of mysql (and memcached)

- name: Deploy MySQL
  hosts: all
  become: True
  gather_facts: True
  vars_files:
  - roles/edxlocal/defaults/main.yml
  - roles/edxapp/defaults/main.yml
  - roles/xqueue/defaults/main.yml
  - roles/analytics_api/defaults/main.yml
  roles:
  - mysql
  - edxlocal
  - memcache

- name: Configure MySQL
  hosts: all
  become: True
  vars_files:
  - roles/edxlocal/defaults/main.yml
  - roles/edxapp/defaults/main.yml
  - roles/xqueue/defaults/main.yml
  - roles/analytics_api/defaults/main.yml
  tasks:
  - name: Update MySQL bind address
    lineinfile:
      dest: /etc/mysql/my.cnf
      regexp: '^bind-address'
      state: absent
  - name: Restart MySQL
    service: name=mysql state=restarted
  - name: Run mysql.sh script
    script: /edx/app/edx_ansible/mysql.sh  
